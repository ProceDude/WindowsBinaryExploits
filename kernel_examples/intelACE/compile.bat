@echo off

set REQUIRED_FILES=intel_driver.cpp intel_driver.hpp intel_driver_resource.hpp nt.hpp service.cpp service.hpp utils.cpp utils.hpp
(type %REQUIRED_FILES% ) >nul 2>&1 || (
	echo Error: missing KdMapper source files, download them from github first.
	echo Required files: %REQUIRED_FILES%
	exit /B 1
)

if #%~1# neq #confirm# (
	echo WARNING: the program you want to compile embeds intel's Network Interface Diagnostic Driver and uses it to enter the kernel!
	echo Pass "confirm" as arg to confirm you want to compile this program that might mess with your kernel.
	exit /B 1
)

cl /nologo /EHsc /std:c++17 /Zi a.cpp intel_driver.cpp service.cpp utils.cpp "C:\Program Files (x86)\Windows Kits\10\Lib\10.0.19041.0\um\x64\AdvAPI32.Lib" /link /out:a.exe
