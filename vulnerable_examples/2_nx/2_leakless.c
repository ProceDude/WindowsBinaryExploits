#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include <windows.h>

const char pw[] = "v3ry_53cr37_p455wd";

// so vs won't complain
char * gets ( char * str );

int readAndCompare(void) {
	char buffer[32];
	gets(buffer);
	return 0 == strcmp(buffer, pw);
}

int main(void) {
	char waste[1024] = "ciao";

	setvbuf(stdin, 0, _IONBF, 0);
	setvbuf(stdout, 0, _IONBF, 0);
	setvbuf(stderr, 0, _IONBF, 0);

	puts("Enter the password:");

	int r = readAndCompare();

	if (r) {
		puts("Secret content!");
	} else {
		puts("Ha! Wrong password!");
	}

	printf("%s", waste+4); // will never happen if there's a buffer overflow
	*(int*)waste = 0x00c3e189; // mov ecx, esp; ret

	return 0;
}

void dummy(void) {
	VirtualAlloc(0, 1, MEM_RESERVE, PAGE_READWRITE);
	ExitProcess(0);
}
