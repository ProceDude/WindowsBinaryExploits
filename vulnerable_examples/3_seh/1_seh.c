#include <stdio.h>
#include <windows.h>

// so vsc doesn't spit out gcc errors
#ifndef _MSC_VER
#define __try
#define __except(expr) if(0)
#endif

// so vs won't complain
char * gets ( char * str );

void main1(void) {
	struct {
		char buffer[32];
		int divisor;
	} s;
	s.divisor = 101;

	setvbuf(stdin, 0, _IONBF, 0);
	setvbuf(stdout, 0, _IONBF, 0);
	setvbuf(stderr, 0, _IONBF, 0);

	// microsoft specific
	__try {
		puts("Hah! You can't pwn this! It has security cookies and even a try/except!!");
		puts("Tell me your name, young pwndwan");

		gets(s.buffer);

		printf("Hi, %s: ", s.buffer);
		printf("your chance of pwning this is %d and you failed!\n", 100 / s.divisor);

	} __except (GetExceptionCode() == EXCEPTION_INT_DIVIDE_BY_ZERO ? 
			EXCEPTION_EXECUTE_HANDLER : EXCEPTION_CONTINUE_SEARCH) {
		
		puts("Nice try.. But you failed!");
	}
}

int main(void) {
	char waste[1024];
	main1();

	puts(waste);
	return 0;
}
