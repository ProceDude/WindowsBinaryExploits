
SRCS := $(wildcard *.c)

TARGETS_GCC :=
TARGETS_VS :=

#gcc 64 bits
TARGETS_GCC := $(TARGETS_GCC) $(patsubst %.c,%_gcc_64.exe,$(SRCS))
#gcc 32 bits
TARGETS_GCC := $(TARGETS_GCC) $(patsubst %.c,%_gcc_32.exe,$(SRCS))
#vs 64 bits
TARGETS_VS := $(TARGETS_VS) $(patsubst %.c,%_vs_64.exe,$(SRCS))
#vs 32 bits
TARGETS_VS := $(TARGETS_VS) $(patsubst %.c,%_vs_32.exe,$(SRCS))

#RENAMEME := $(patsubst %.c,%_vs_32.exe,$(SRCS))

# PDBs
DEBUG_FILES := $(patsubst %.exe,bin/%.pdb,$(TARGETS_VS))

#-Wl,--nxcompat enables DEP
GCC_FLAGS := -g -O0 -Wall \
	-no-pie -fno-pic -fno-stack-protector -fcf-protection=full -Wl,--nxcompat

# Od optimizations disabled
# Wall max warning level
# Zi debug info in pdb, Z7 embed debug info
# GS- disables security cookies (canaries)
# guard:cf enables cfg
# /DYNAMICBASE enables pie (required by cfg)
# /CETCOMPAT:NO disabled Control-flow Enhancement Technology
VS_CFLAGS := /Od /Wall /Zi /GS- /guard:cf
VS_LDFLAGS := /DYNAMICBASE /CETCOMPAT:NO /SAFESEH:NO /guard:cf /INCREMENTAL:NO
#/FIXED /NXCOMPAT:NO

.PHONY: default all clean gcc vs

default: vs

all: gcc vs

clean:
	rm -rf $(TARGETS_GCC) $(TARGETS_VS) $(DEBUG_FILES)

gcc: $(TARGETS_GCC)

vs: $(TARGETS_VS)

include ../common/c_rules.makefile
