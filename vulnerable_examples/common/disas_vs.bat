
@set FILE=%~1
@set FUNC=%~2

@REM check if args were passed
@set RES=F
@if #%FILE%#==## set RES=T
@if #%FUNC%#==## set RES=T
@if T==%RES% (
	echo "usage: %0 <exefile> <function>"
)

@dumpbin /disasm %FILE% | grep -E "_?%FUNC%" >nul

@if not 0==%ERRORLEVEL% (
	echo %FUNC% not in %FILE%
	exit /b
)

@dumpbin /disasm %FILE% | tr "\r\n" "\^#" | sed -r "s/^.*(\^#_?%FUNC%:\^#)/\1/" | sed -r "s@(ret\^#)([ \t]*[0-9a-fA-F]+: CC[^#]*\^#)*[_0-9a-zA-Z<>:?@]+:[ \t]*\^#.*@\1@" | tr "\^#" "\r\n"
